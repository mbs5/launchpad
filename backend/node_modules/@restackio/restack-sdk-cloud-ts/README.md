# Restack cloud sdk

The Restack SDK allows you to manage and deploy stacks and applications to the Restack platform. This README provides instructions on how to use the SDK.

## Installation

First, install the necessary dependencies:

```node
npm install @restackio/restack-sdk-cloud-ts
```

## Configuration

Create a `.env` file in the root of your project and add your Restack SDK token:
To get your sdk token navigate to the restack console and generate a new one under your workspace settings.

```env
RESTACK_SDK_TOKEN=your_restack_sdk_token
```

In case you don't want the SDK to ask for your confirmation before applying changes set on your `.env`. This is ideally set on your cicd pipeline so there is no blocking prompt and deployment doesn't asks for user confirmation.

```env
RESTACK_CICD=true
```

## Usage

Below is an example of how to use the Restack SDK to create and deploy stacks and applications.

### Example

Create a file named `restack_up.ts` or `restack_up.js` and add the following content:

```typescript
import * as dotenv from 'dotenv';
import {RestackCloud} from '@restackio/restack-sdk-cloud-ts';
dotenv.config();

const main = async () => {
  const restackCloudClient = new RestackCloud(
    process.env.RESTACK_SDK_TOKEN as string,
  );

  const frontendApp = {
    name: 'my-ai-application', // application name is used as a persistent identifier. Changing your application name will result in creating a new application on the restack console. The uniqueness is at the stack level. An application can share name as long as they are not in the same stack.
    dockerFilePath: 'Dockerfile',
    environmentVariables: [
      {
        name: 'TEST_VARIABLE',
        value: 'test_2',
      },
    ],
  };

  await restackCloudClient.stack({
    name: 'production environment',
    previewEnabled: false,
    applications: [frontendApp],
  });

  await restackCloudClient.up();
};

main();
```

## API

```typescript

- `token`: Your Restack SDK token. You can generate a token in the Restack console under your workspace settings.

#### Methods

- `stack({name, previewEnabled, applications}: {name: string, previewEnabled: boolean, applications: Array<{name: string, dockerFilePath: string, environmentVariables: Array<Record<string,any>>}>}): Promise<string>`
  - Creates a plan for a stack with its applications.
  - `name`: The name of the stack.
  - `previewEnabled`: Whether preview environments are enabled for the stack.
  - `applications`: Array of applications to be part of the stack

- `up(): Promise<void>`
  - Deploys the stack and applications.
```

## Notes

Stack names are used as unique identifiers, so when creating multiple stacks on restack_up config file please make sure names are unique. Application name uniqueness is only bound to the scope inside the stack it belongs to. Meaning you can have two apps with same name as long as they are not part of the same stack.
